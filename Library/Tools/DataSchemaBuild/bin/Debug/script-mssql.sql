--
-- Autogenerated SQL script for database schema Project
-- Generated at 2013-01-04T12:21:55
-- Knightrunner.Library.Database.Schema.SqlServer.SqlServerScriptGenerator, Knightrunner.Library.Database.Schema.SqlServer, Version=1.1.0.0, Culture=neutral, PublicKeyToken=8edf591bb966d98e

CREATE TABLE [dbo].[sr_repository]
(
	[id_repository] Bigint IDENTITY NOT NULL,
	[name] NVarChar(255) NOT NULL,
	[created] DateTime NOT NULL,
	[created_by] NVarChar(255) NOT NULL,
	[modified] DateTime NOT NULL,
	[modified_by] NVarChar(255) NOT NULL
);

ALTER TABLE [dbo].[sr_repository] ADD CONSTRAINT [sr_repository_pk] PRIMARY KEY CLUSTERED
([id_repository]);

CREATE UNIQUE INDEX [sr_repository_name_uq] ON [dbo].[sr_repository]
([name]);

GO

CREATE TABLE [dbo].[sr_software_item]
(
	[id_software_item] Bigint IDENTITY NOT NULL,
	[id_repository] Bigint NOT NULL,
	[name] NVarChar(1000) NOT NULL,
	[software_item_type] SmallInt NOT NULL,
	[status] SmallInt NOT NULL,
	[id_team] Bigint,
	[description] NVarChar(2000),
	[description_url] NVarChar(1000),
	[deployment_directory] NVarChar(500),
	[implementation] NVarChar(1000),
	[source_control_path] NVarChar(500),
	[drop_location] NVarChar(500),
	[build_name] NVarChar(255),
	[log_application_name] NVarChar(255),
	[log_application_version] NVarChar(255),
	[external_id] NVarChar(100)
);

ALTER TABLE [dbo].[sr_software_item] ADD CONSTRAINT [sr_software_item_pk] PRIMARY KEY CLUSTERED
([id_software_item]);

CREATE UNIQUE INDEX [sr_software_item_id_name_uk] ON [dbo].[sr_software_item]
([id_repository], [name]);

GO

CREATE TABLE [dbo].[sr_file_item]
(
	[id_file_item] Bigint IDENTITY NOT NULL,
	[id_software_item] Bigint NOT NULL,
	[file_path] NVarChar(500) NOT NULL,
	[version] NVarChar(255)
);

ALTER TABLE [dbo].[sr_file_item] ADD CONSTRAINT [sr_file_item_pk] PRIMARY KEY CLUSTERED
([id_file_item]);

CREATE UNIQUE INDEX [sr_file_item_path_uk] ON [dbo].[sr_file_item]
([id_software_item], [file_path]);

GO

CREATE TABLE [dbo].[sr_measurement]
(
	[id_measurement] Bigint IDENTITY NOT NULL,
	[id_software_item] Bigint NOT NULL,
	[measurement_type] SmallInt NOT NULL,
	[created] DateTime NOT NULL,
	[period] Int NOT NULL,
	[detail] NVarChar(255),
	[measurement_value] Bigint NOT NULL
);

ALTER TABLE [dbo].[sr_measurement] ADD CONSTRAINT [sr_measurement_pk] PRIMARY KEY CLUSTERED
([id_measurement]);

CREATE UNIQUE INDEX [sr_measurement_uk] ON [dbo].[sr_measurement]
([id_software_item], [measurement_type], [period], [detail]);

GO

CREATE TABLE [dbo].[sr_dependency]
(
	[id_dependency] Bigint IDENTITY NOT NULL,
	[id_software_item_from] Bigint NOT NULL,
	[id_software_item_to] Bigint NOT NULL,
	[source] SmallInt NOT NULL,
	[type] SmallInt NOT NULL
);

ALTER TABLE [dbo].[sr_dependency] ADD CONSTRAINT [sr_dependency_pk] PRIMARY KEY CLUSTERED
([id_dependency]);

CREATE UNIQUE INDEX [sr_dependency_from_to_uk] ON [dbo].[sr_dependency]
([id_software_item_from], [id_software_item_to]);

GO

CREATE TABLE [dbo].[sr_measurement_bookmark]
(
	[id_measurement_bookmark] Bigint IDENTITY NOT NULL,
	[id_repository] Bigint NOT NULL,
	[measurement_type] SmallInt NOT NULL,
	[last_datetime] DateTime NOT NULL
);

ALTER TABLE [dbo].[sr_measurement_bookmark] ADD CONSTRAINT [sr_measurement_bookmark_pk] PRIMARY KEY CLUSTERED
([id_measurement_bookmark]);

CREATE UNIQUE INDEX [sr_measurement_bookmark_uq] ON [dbo].[sr_measurement_bookmark]
([id_repository], [measurement_type]);

GO

CREATE TABLE [dbo].[sr_team]
(
	[id_team] Bigint IDENTITY NOT NULL,
	[name] NVarChar(255) NOT NULL,
	[active] Bit NOT NULL,
	[contact] NVarChar(1000),
	[external_id] NVarChar(100)
);

ALTER TABLE [dbo].[sr_team] ADD CONSTRAINT [sr_team_pk] PRIMARY KEY CLUSTERED
([id_team]);

CREATE UNIQUE INDEX [sr_team_uq] ON [dbo].[sr_team]
([name]);

GO

GO

ALTER TABLE [dbo].[sr_software_item] WITH CHECK ADD CONSTRAINT [sr_software_item_repository_fk] FOREIGN KEY
([id_repository]) REFERENCES [dbo].[sr_repository] ([id_repository]);
ALTER TABLE [dbo].[sr_software_item] WITH CHECK ADD CONSTRAINT [sr_software_item_id_team_fk] FOREIGN KEY
([id_team]) REFERENCES [dbo].[sr_team] ([id_team]);
GO

ALTER TABLE [dbo].[sr_file_item] WITH CHECK ADD CONSTRAINT [sr_file_item_software_item_fk] FOREIGN KEY
([id_software_item]) REFERENCES [dbo].[sr_software_item] ([id_software_item]);
GO

ALTER TABLE [dbo].[sr_measurement] WITH CHECK ADD CONSTRAINT [sr_measurement_fk] FOREIGN KEY
([id_software_item]) REFERENCES [dbo].[sr_software_item] ([id_software_item]);
GO

ALTER TABLE [dbo].[sr_dependency] WITH CHECK ADD CONSTRAINT [sr_dependency_from_fk] FOREIGN KEY
([id_software_item_from]) REFERENCES [dbo].[sr_software_item] ([id_software_item]);
ALTER TABLE [dbo].[sr_dependency] WITH CHECK ADD CONSTRAINT [sr_dependency_to_fk] FOREIGN KEY
([id_software_item_to]) REFERENCES [dbo].[sr_software_item] ([id_software_item]);
GO

ALTER TABLE [dbo].[sr_measurement_bookmark] WITH CHECK ADD CONSTRAINT [sr_measurement_bookmark_fk] FOREIGN KEY
([id_repository]) REFERENCES [dbo].[sr_repository] ([id_repository]);
GO

GO

